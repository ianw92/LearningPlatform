<div class='row'>
  <div class='col-12 col-lg-11'>
    <h3><%= @page_title %></h3>
  </div>
  <div class='col-3 col-lg-1'>
    <% if can? :edit, @lecture_module %>
      <%= link_to edit_lecture_module_path(@lecture_module), data: { toggle: 'edit-lecture-module-tooltip'}, title: 'Edit Module' do %>
        <i class="fas fa-pencil-alt"></i>
      <% end %>
      |
    <% end %>
    <% if can? :destroy, @lecture_module %>
      <%= link_to @lecture_module, method: :delete, data: { confirm: 'Are you sure?', toggle: 'delete-lecture-module-tooltip'}, title: 'Delete Module' do %>
        <i class="fas fa-trash-alt"></i>
      <% end %>
    <% end %>
  </div>
</div>


<ul class="nav nav-tabs">
  <li class="nav-item active"><a data-toggle="tab" href="#week1" class="nav-link small active"><h6>Week 1</h6></a></li>
  <% for i in 2..12 do %>
    <li class="nav-item"><a data-toggle="tab" href="#week<%= i %>" class="nav-link small"><h6>Week <%= i %></h6></a></li>
  <% end %>
</ul>

<div class="tab-content">
  <% for i in 1..12 do %>
    <% if i == 1 %>
    <div id="week1" class="tab-pane fade in active show">
    <% else %>
    <div id="week<%= i %>" class="tab-pane fade">
    <% end %>
      <br>
      <% if can? :new, LectureModuleContent.new(week: @weeks[i-1]) %>
        <%= link_to new_lecture_module_content_path(week: @weeks[i-1]), class: 'float-right' do %>
          Add Content to Week <%= i %>
        <% end %>
      <% end %>
      <h3>Week <%= i %></h3>


      <% if @weekly_content[i-1].empty? %>
        <p>No content exists for Week <%= i %> of this module yet.</p>
      <% else %>
        <div id="content-section">
          <ul class="list-unstyled">
              <%= render partial: "lecture_module_contents/lecture_module_content",
                         collection: @weekly_content[i-1],
                         locals: { show_pdf: true,
                                   show_youTube: true } %>
          </ul>
        </div>


        <!-- TODO make this next bit a partial? -->
        <div id="notes-section">
          <% if @weeks_with_notes.include? i %>
            <% @notes.each do |note| %>
              <% if note.week_id % 12 == i %>
                <h3>Notes</h3>
                <%= render 'notes/add_edit_notes', note: note, user: current_user, lecture_module: @lecture_module, week: @weeks[i-1].id %>

              <% end %>
            <% end %>
          <% else %>
            <h3>Add new note</h3>
            <%= render 'notes/add_edit_notes', note: Note.new, user: current_user, lecture_module: @lecture_module, week: @weeks[i-1].id %>
          <% end %>
          <hr>
          <br>
        </div>


        <div class="card bg-light" id="comment-section" style="max-height: 450px;">
          <h3 style="padding-left:5px">Discussion</h3>
          <% if can? :read, Comment.new(week_id: @weeks[i-1].id) %>
            <div class="card-body" style="padding: 5px;overflow-y: scroll; overflow-x: hidden;">
            <% if !@weeks[i-1].comments.empty? %>
              <%= render partial: "comments/comment", locals: { week: @weeks[i-1] } %>
            <% else %>
              <p>No comments in this discussion yet.</p>
            <% end %>
            <%= render partial: "comments/form",
                       locals: { week: @weeks[i-1],
                                 comment: Comment.new(week_id: @weeks[i-1].id,
                                                     user_id: current_user.id )
                                } %>
            </div>
            <% else %>
              <p style="padding-left:5px">Add this module to your modules to see the discussion.</p>
            <% end %>
        </div>

      <% end %>

    </div>

  <% end %>
</div>

<br>
<hr>
<br>
<p>Any notes that you add to a module will only be visible by you.</p>
